var canvas=document.getElementById("canvas");var cxt=canvas.getContext("2d");var color=document.getElementById("color");var submit=document.getElementById("submit");var start=document.getElementById("start");var pause=document.getElementById("pause");var tips=document.getElementById("tips");cxt.save();cxt.font="36px Verdana";cxt.fillStyle="#FF0033";cxt.fillText("Are you ready?",15,190);cxt.fillText("go?",130,250);cxt.restore();var w=canvas.width;var h=canvas.height;var timer;var isStop=true;var index=0;var snake_bodys=[{"x":20,"y":20},{"x":40,"y":20},{"x":60,"y":20}];var snake_body_len=20;var snake_head={"x":20,"y":20};var snake_direction="s";var worm={"x":200,"y":200};var snake_last;var score=0;var snake_color="#00CC00";var snake_border_color="#fff";var snake_eye_color="#000";var worm_color="#A0522D";function erase(){cxt.clearRect(0,0,w,h)}function drawSnake(){cxt.save();cxt.strokeStyle=snake_border_color;cxt.fillStyle=snake_color;for(var i=0;i<snake_bodys.length;i++){cxt.fillRect(snake_bodys[i].x,snake_bodys[i].y,snake_body_len,snake_body_len);cxt.strokeRect(snake_bodys[i].x,snake_bodys[i].y,snake_body_len,snake_body_len)}cxt.restore();cxt.save();cxt.fillStyle=snake_eye_color;cxt.beginPath();cxt.arc(snake_head.x+10,snake_head.y+10,4,0,2*Math.PI,false);cxt.fill();cxt.closePath();cxt.restore()}function drawWorm(){cxt.save();cxt.fillStyle=worm_color;cxt.fillRect(worm.x,worm.y,snake_body_len,snake_body_len);cxt.restore()}function createWorm(){var x=Math.floor(Math.random()*15);var y=Math.floor(Math.random()*25);worm={"x":x*20,"y":y*20}}function step(){switch(snake_direction){case"e":snake_head={"x":snake_head.x+snake_body_len,"y":snake_head.y};break;case"s":snake_head={"x":snake_head.x,"y":snake_head.y+snake_body_len};break;case"w":snake_head={"x":snake_head.x-snake_body_len,"y":snake_head.y};break;case"n":snake_head={"x":snake_head.x,"y":snake_head.y-snake_body_len};break;default:break}if(snake_head.x==worm.x&&snake_head.y==worm.y){createWorm();snake_bodys.push(snake_last);score++}snake_last=snake_bodys.pop();snake_bodys.unshift(snake_head);for(var i=1;i<snake_bodys.length;i++){if(snake_head.x==snake_bodys[i].x&&snake_head.y==snake_bodys[i].y){isStop=true;break}}if(snake_head.x>=w||snake_head.x<0||snake_head.y>=h||snake_head.y<0){isStop=true}}function drawScore(){cxt.save();cxt.font="bold 22px Microsoft Yahei";cxt.fillStyle="#990033";cxt.fillText("得分："+score,190,50);cxt.restore()}function drawOver(){cxt.save();cxt.font="bold 30px Microsoft Yahei";cxt.fillStyle="#FF0033";cxt.fillText("Game over",50,190);cxt.font="bold 20px Microsoft Yahei";cxt.fillText("\n您的分数是："+score,80,250);cxt.restore()}var last=new Date();document.onkeydown=(function(e){var now=new Date();if(now.getTime()-last.getTime()<100){return}last=now;switch(e.which){case 39:if(snake_direction!="w"){snake_direction="e"}break;case 40:if(snake_direction!="n"){snake_direction="s"}break;case 37:if(snake_direction!="e"){snake_direction="w"}break;case 38:if(snake_direction!="s"){snake_direction="n"}break}});window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.cancelRequestAnimationFrame=window.cancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame;function animate(){index++;if(index%10==0){step()}erase();drawSnake();drawWorm();drawScore();if(isStop){cancelRequestAnimationFrame(timer);drawOver()}else{timer=requestAnimationFrame(animate)}}start.onclick=function(){isStop=false;animate()};pause.onclick=function(e){window.cancelRequestAnimationFrame(timer)};